# RAG κΈ°λ° μ±—λ΄‡ μ„λ²„ π¤–

μ–΄λ¥΄μ‹ λ“¤μ„ μ„ν• λ”°λ»ν• λ§λ™λ¬΄ μ±—λ΄‡ μ„λ²„μ…λ‹λ‹¤.  
RAG (Retrieval-Augmented Generation)μ™€ λ€ν™” λ©”λ¨λ¦¬ κΈ°λ¥μ„ κ°–μ¶ λ¨λ“ν™”λ LLM μ„λ²„μ…λ‹λ‹¤.

## π“‹ μ£Όμ” κΈ°λ¥

- β… **RAG (λ¬Έμ„ κ²€μƒ‰ κΈ°λ° μ‘λ‹µ)**: λ²΅ν„° DBλ¥Ό ν™μ©ν• μ •ν™•ν• μ •λ³΄ μ κ³µ
- π’¬ **λ€ν™” λ©”λ¨λ¦¬**: μ‚¬μ©μλ³„ λ€ν™” κΈ°λ΅ μ €μ¥ λ° μ»¨ν…μ¤νΈ μ μ§€
- π“ **λ¬Έμ„ κ΄€λ¦¬**: λ™μ  λ¬Έμ„ μ¶”κ°€/κ²€μƒ‰/μ‚­μ 
- π”§ **λ¨λ“ν™” μ„¤κ³„**: κ° κΈ°λ¥μ΄ λ…λ¦½μ μΈ λ¨λ“λ΅ λ¶„λ¦¬
- π“ **JSON κΈ°λ° μ„¤μ •**: μ™Έλ¶€ μ„λ²„μ™€μ μ›ν™ν• μ†ν†µ
- π **RESTful API**: FastAPI κΈ°λ°μ κΉ”λ”ν• API

## π—οΈ ν”„λ΅μ νΈ κµ¬μ΅°

```
ν”„λ΅μ νΈ/
β”β”€β”€ config.py              # μ„¤μ • κ΄€λ¦¬ (JSON λ΅λ“)
β”β”€β”€ config.json            # β­ μ„λ²„ μ„¤μ • (JSON ν•μ‹)
β”β”€β”€ services.py            # β­ λΉ„μ¦λ‹μ¤ λ΅μ§ (λ‚΄λ¶€ μ²λ¦¬)
β”β”€β”€ main.py                # β­ API μ—”λ“ν¬μΈνΈ (μ™Έλ¶€ ν†µμ‹ )
β”β”€β”€ prompts.py             # μ‹μ¤ν… ν”„λ΅¬ν”„νΈ κ΄€λ¦¬
β”β”€β”€ llm_manager.py         # LLM λ¨λΈ κ΄€λ¦¬
β”β”€β”€ rag_manager.py         # RAG κ΄€λ¦¬
β”β”€β”€ memory_manager.py      # λ€ν™” λ©”λ¨λ¦¬ κ΄€λ¦¬
β”β”€β”€ models.py              # API λ¨λΈ μ •μ
β”β”€β”€ client_test.py         # ν…μ¤νΈ ν΄λΌμ΄μ–ΈνΈ
β”β”€β”€ .env                   # ν™κ²½ λ³€μ (API ν‚¤)
β”β”€β”€ .env.example           # ν™κ²½ λ³€μ μμ‹
β”β”€β”€ system_prompt.json     # μ‹μ¤ν… ν”„λ΅¬ν”„νΈ μ„¤μ •
β””β”€β”€ requirements.txt       # μμ΅΄μ„± ν¨ν‚¤μ§€
```

### β­ μƒλ΅μ΄ κµ¬μ΅° (v3.2.0)

#### 1. **config.json** - JSON κΈ°λ° μ„¤μ •
λ¨λ“  μ„¤μ •κ°’μ„ JSON νμΌλ΅ λ¶„λ¦¬ν•μ—¬ μ™Έλ¶€ μ„λ²„μ™€ μ‰½κ² μ„¤μ •μ„ κ³µμ ν•  μ μμµλ‹λ‹¤.

#### 2. **services.py** - λΉ„μ¦λ‹μ¤ λ΅μ§
API μ—”λ“ν¬μΈνΈμ μ‹¤μ  μ²λ¦¬ λ΅μ§μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤. (λ‚΄λ¶€ μ „μ©)
- `ChatService`: μ±„ν… μ‘λ‹µ μƒμ„±
- `DocumentService`: λ¬Έμ„ κ΄€λ¦¬
- `MemoryService`: λ©”λ¨λ¦¬ κ΄€λ¦¬
- `StatsService`: ν†µκ³„ λ° ν—¬μ¤μ²΄ν¬

#### 3. **main.py** - API μ—”λ“ν¬μΈνΈ
μ™Έλ¶€ μ„λ²„μ™€ ν†µμ‹ ν•λ” APIλ§ μ •μν•©λ‹λ‹¤. (μ™Έλ¶€ νΈμ¶μ©)

## β™οΈ μ„¤μΉ λ° μ„¤μ •

### 1. μμ΅΄μ„± μ„¤μΉ

```bash
pip install -r requirements.txt
```

### 2. ν™κ²½ λ³€μ μ„¤μ •

`.env.example` νμΌμ„ λ³µμ‚¬ν•μ—¬ `.env` νμΌμ„ μƒμ„±ν•©λ‹λ‹¤:

```bash
cp .env.example .env
```

κ·Έλ¦¬κ³  `.env` νμΌμ„ μ—΄μ–΄μ„ OpenAI API ν‚¤λ¥Ό μ…λ ¥ν•©λ‹λ‹¤:

```env
# OpenAI API Key
OPENAI_API_KEY=your-actual-api-key-here
```

### 3. μ„¤μ • νμΌ ν™•μΈ

`config.json` νμΌμ—μ„ μ„λ²„ μ„¤μ •μ„ ν™•μΈν•κ³  ν•„μ”μ‹ μμ •ν•©λ‹λ‹¤:

```json
{
  "server": {
    "host": "0.0.0.0",
    "port": 8002
  },
  "model": {
    "llm_model": "gpt-3.5-turbo",
    "embedding_model": "text-embedding-3-small"
  }
}
```

### 4. μ„λ²„ μ‹¤ν–‰

```bash
python main.py
```

μ„λ²„κ°€ `http://localhost:8002`μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.

## π€ μ‚¬μ© λ°©λ²•

### API μ—”λ“ν¬μΈνΈ

#### 1. λ€ν™” μƒμ„±
```bash
POST /generate
```

**μ”μ²­ μμ‹:**
```python
import requests

response = requests.post("http://localhost:8002/generate", json={
    "text": "μ•λ…•ν•μ„Έμ”",
    "user_id": "user123",
    "use_rag": True,
    "use_memory": True
})

print(response.json())
```

#### 2. λ¬Έμ„ μ¶”κ°€
```bash
POST /documents/add
```

**μ”μ²­ μμ‹:**
```python
requests.post("http://localhost:8002/documents/add", json={
    "content": "λ³µμ§€ μ •λ³΄: μ—°μ°¨λ” 15μΌμ΄ μ κ³µλ©λ‹λ‹¤.",
    "metadata": {"category": "λ³µμ§€"}
})
```

#### 3. μ„λ²„ μ„¤μ • μ΅°ν (μƒλ΅μ΄ κΈ°λ¥!)
```bash
GET /config
```

μ„λ²„μ ν„μ¬ μ„¤μ •μ„ JSON ν•μ‹μΌλ΅ λ°ν™ν•©λ‹λ‹¤.

#### 4. λ€ν™” κΈ°λ΅ μ΅°ν
```bash
GET /memory/{user_id}
```

#### 5. λ€ν™” κΈ°λ΅ μ‚­μ 
```bash
DELETE /memory/{user_id}
```

#### 6. μ„λ²„ ν†µκ³„
```bash
GET /stats
```

### ν…μ¤νΈ ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰

```bash
python client_test.py
```

## π“ μ„¤μ • νμΌ (config.json)

### κΈ°λ³Έ κµ¬μ΅°

```json
{
  "server": {
    "host": "0.0.0.0",
    "port": 8002,
    "title": "RAG-based LLM Server",
    "description": "λ¨λ“ν™”λ RAG κΈ°λ° LLM μ„λ²„",
    "version": "3.2.0"
  },
  "model": {
    "llm_model": "gpt-3.5-turbo",
    "embedding_model": "text-embedding-3-small"
  },
  "llm_parameters": {
    "temperature": 0.7,
    "max_tokens": 300
  },
  "paths": {
    "chroma_persist_dir": "./chroma_db",
    "memory_dir": "./chat_history",
    "system_prompt_file": "./system_prompt.json"
  },
  "memory": {
    "k": 5
  },
  "rag": {
    "chunk_size": 500,
    "chunk_overlap": 50,
    "retriever_k": 3
  }
}
```

### μ„¤μ •κ°’ λ³€κ²½ λ°©λ²•

1. `config.json` νμΌμ„ μ§μ ‘ μμ •
2. μ„λ²„ μ¬μ‹μ‘
3. λλ” APIλ¥Ό ν†µν•΄ λ™μ μΌλ΅ λ³€κ²½ (ν–¥ν›„ κΈ°λ¥)

## π›οΈ μ•„ν‚¤ν…μ²

### λ μ΄μ–΄ κµ¬μ΅°

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  main.py (API μ—”λ“ν¬μΈνΈ)            β”‚ β† μ™Έλ¶€ μ„λ²„μ™€ ν†µμ‹ 
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  services.py (λΉ„μ¦λ‹μ¤ λ΅μ§)         β”‚ β† λ‚΄λ¶€ μ²λ¦¬
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  Managers (llm, rag, memory λ“±)     β”‚ β† ν•µμ‹¬ κΈ°λ¥
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  config.json + .env (μ„¤μ •)          β”‚ β† μ„¤μ • κ΄€λ¦¬
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### λ¨λ“ μ„¤λ…

#### μ™Έλ¶€ ν†µμ‹  λ μ΄μ–΄
- **main.py**: FastAPI μ—”λ“ν¬μΈνΈλ§ μ •μ
- **models.py**: API μ”μ²­/μ‘λ‹µ λ°μ΄ν„° λ¨λΈ

#### λΉ„μ¦λ‹μ¤ λ΅μ§ λ μ΄μ–΄
- **services.py**: μ‹¤μ  μ²λ¦¬ λ΅μ§
  - `ChatService`: μ±„ν… μƒμ„±
  - `DocumentService`: λ¬Έμ„ κ΄€λ¦¬
  - `MemoryService`: λ©”λ¨λ¦¬ κ΄€λ¦¬
  - `StatsService`: ν†µκ³„

#### ν•µμ‹¬ κΈ°λ¥ λ μ΄μ–΄
- **config.py**: JSON μ„¤μ • λ΅λ“
- **llm_manager.py**: LLM λ¨λΈ κ΄€λ¦¬
- **rag_manager.py**: RAG μ²λ¦¬
- **memory_manager.py**: λ©”λ¨λ¦¬ κ΄€λ¦¬
- **prompts.py**: ν”„λ΅¬ν”„νΈ κ΄€λ¦¬

#### μ„¤μ • λ μ΄μ–΄
- **config.json**: μ„λ²„ μ„¤μ •
- **.env**: API ν‚¤ (λ³΄μ•)
- **system_prompt.json**: AI μ„±κ²© μ„¤μ •

## π”’ λ³΄μ• μ£Όμμ‚¬ν•­

- β οΈ **`.env` νμΌμ„ μ λ€ Gitμ— μ»¤λ°‹ν•μ§€ λ§μ„Έμ”!**
- β οΈ **API ν‚¤λ¥Ό μ½”λ“μ— μ§μ ‘ μ‘μ„±ν•μ§€ λ§μ„Έμ”!**
- β… `.gitignore`μ— `.env`κ°€ ν¬ν•¨λμ–΄ μλ”μ§€ ν™•μΈν•μ„Έμ”

## π”„ λ³€κ²½ μ΄λ ¥

### v3.2.0 (2024-11-11)
- β¨ JSON κΈ°λ° μ„¤μ •μΌλ΅ λ³€κ²½ (`config.json`)
- β¨ λΉ„μ¦λ‹μ¤ λ΅μ§μ„ `services.py`λ΅ λ¶„λ¦¬
- β¨ API μ—”λ“ν¬μΈνΈμ™€ λ‚΄λ¶€ λ΅μ§ λ…ν™•ν λ¶„λ¦¬
- β¨ μ„λ²„ μ„¤μ • μ΅°ν API μ¶”κ°€ (`GET /config`)
- π”§ CORS μ„¤μ •μ„ JSONμΌλ΅ κ΄€λ¦¬
- π“ μ‹μ¤ν… ν”„λ΅¬ν”„νΈ κ°μ„  (λ” μΉκ·Όν• μ–΄μ΅°)

### v3.1.0
- ν™κ²½λ³€μ κΈ°λ° μ„¤μ • (`.env`)
- λ¨λ“ν™”λ κµ¬μ΅°

## π› λ¬Έμ  ν•΄κ²°

### config.json μ¤λ¥
```
FileNotFoundError: config.json νμΌμ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤!
```
β†’ ν”„λ΅μ νΈ λ£¨νΈμ— `config.json` νμΌμ΄ μλ”μ§€ ν™•μΈν•μ„Έμ”.

### API ν‚¤ μ¤λ¥
```
ValueError: OPENAI_API_KEYκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤!
```
β†’ `.env` νμΌμ— μ¬λ°”λ¥Έ API ν‚¤λ¥Ό μ„¤μ •ν–λ”μ§€ ν™•μΈν•μ„Έμ”.

### ν¬νΈ μ¶©λ
```
OSError: [Errno 48] Address already in use
```
β†’ `config.json`μ—μ„ `server.port`λ¥Ό λ‹¤λ¥Έ λ²νΈλ΅ λ³€κ²½ν•μ„Έμ”.

## π“„ λΌμ΄μ„ μ¤

μ΄ ν”„λ΅μ νΈλ” κ°μΈ/κµμ΅ λ©μ μΌλ΅ μμ λ΅­κ² μ‚¬μ© κ°€λ¥ν•©λ‹λ‹¤.

## π‘¥ κΈ°μ—¬

λ²„κ·Έ λ¦¬ν¬νΈλ‚ κΈ°λ¥ μ μ•μ€ ν™μν•©λ‹λ‹¤!
